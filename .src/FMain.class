' Gambas class file

Public YoutubeDL_sOutput As String = ""
Public myfile As String = ""
Public VideoURLImage As String = ""
Public VideoURLTile As String = ""
'Messages
Public MSG_No_VideoURL As String = ("Please enter a video url.")
Public MSG_Invailed_VideoURL As String = ("Invailed video url please use http or https.")
Public MSG_No_SaveTo_Dir As String = ("Please select a save to directory.")
Public MSG_No_VideoURLS As String = ("Please add one or more video url's.")
Public MSG_No_url_To_Remove As String = ("Please select a url to remove.")
Public MSG_URL_Already_Exist As String = ("This url has already been added.")
Public MSG_ClearList As String = ("Clear url list,Are you sure?.")
MSG_ClearList_No As String = ("No")
MSG_ClearList_Yes As String = ("Yes")

Public Sub _new()
  
End

Public Sub Form_Open()
  
  FMain.Center

  WebSettings.IconDatabase.Path = File.Dir(File.Dir(Temp$()))
  WebSettings.Fonts.FixedFont = "Monospace"
  WebSettings[WebSettings.PluginsEnabled] = True
  WebSettings[WebSettings.JavascriptEnabled] = True
  WebSettings[WebSettings.JavaEnabled] = True
  'WebSettings.Fonts.DefaultFontSize = 12
  'WebSettings.Fonts.DefaultFixedFontSize = 12
  
  Spinner1.Stop
  
  If Exist("/home/" & System.User.Name & "/Videos") = True Then
    TextBox_SaveTo.Text = "/home/" & System.User.Name & "/Videos"
  Endif
  
End

Public Sub Button_VideoURL_Click()

If Clipboard.Text = 1 Then
TextBox_VideoURL.Text = Clipboard.Paste()
  Module1.Add_VideoURL()
Endif
  
End

Public Sub PictureBox_Clear_MouseDown()
  
  TextBox_VideoURL.Clear
  
End

Public Sub Button_Remove_Click()
  
  If Not IconView_VideoURL.key = "" Then
    IconView_VideoURL.Remove(IconView_VideoURL.key)
  Else
    Message.Info(MSG_No_url_To_Remove)
  Endif
  
End

Public Sub Button_SaveTo_Click()
  
  Dialog.Title = "Select A Directory"
  Dialog.Path = ""
  
  If Dialog.SelectDirectory() Then Return
  TextBox_SaveTo.Text = Dialog.Path
  
End

Public Sub Button_OpenFolder_Click()
  
  If Not TextBox_SaveTo.Text = "" Then
    Shell "xdg-open " & TextBox_SaveTo.Text
  Else
    Message.Info(MSG_No_SaveTo_Dir)
  Endif
  
End

Public Sub Button_Download_Click()
  
  If TextBox_SaveTo.Text = "" Then
    Message.Info(MSG_No_SaveTo_Dir)
  Else
    If IconView_VideoURL.Count = 0 Then
      Message.Info(MSG_No_VideoURLS)
    Else
      FDownloadOut.Show
      Button_Download.Enabled = False
    Endif
  Endif
  
End

Public Sub Button_Up_Click()
  
  'Dim tmp As String
  'Dim i As Integer
  
  'If Not IconView_VideoURL.Count <= 1 Then
  'If IconView_VideoURL.Index > 0 Then
  'tmp = IconView_VideoURL.Text
  'i = IconView_VideoURL.Index
  'IconView_VideoURL.Remove(i)
  'IconView_VideoURL.Add(tmp, i - 1)
  'IconView_VideoURL.Index = i - 1
  'IconView_VideoURL.SetFocus
  'End If
  'End If
  
End 

Public Sub Button_Down_Click()
  
  'Dim tmp As String
  'Dim i As Integer
  
  'If Not IconView_VideoURL.Count <= 1 Or IconView_VideoURL.Index < 0 Then
  'If IconView_VideoURL.Index < (IconView_VideoURL.Count - 1) Then
  'tmp = IconView_VideoURL.Text
  'i = IconView_VideoURL.Index
  'IconView_VideoURL.Remove(i)
  'IconView_VideoURL.Add(tmp, i + 1)
  'IconView_VideoURL.Index = i + 1
  'IconView_VideoURL.SetFocus
  'End If 
  'End If 
  
End

Public Sub TextBox_VideoURL_KeyPress()
  
  If Key.code = Key.Return Then
    Module1.Add_VideoURL
  Endif
  
End

Public Sub Button_About_Click()
  
  FAbout.Show
  
End

Public Sub HttpClient1_Finished()
  
  Dim TempImage As Picture = image.Load("~/Pictures/Tempthumb.jpg").Stretch(64, 32).Picture
  
  IconView_VideoURL.Add(TextBox_VideoURL.Text, VideoURLTile, TempImage)
  TextBox_VideoURL.Clear
  
End

Public Sub IconView_VideoURL_DblClick()
  
  If Not IconView_VideoURL.Key = "" Then
    FWebBrowser.WebView1.Url = IconView_VideoURL.Item.Key
  Endif
  
End

Public Sub Button_WebBrowser_Click()  
  FWebBrowser.Show
  
End


Public Sub TrayIcon1_Menu()

  TrayMenu1.Popup()

End

Public Sub Button3_Click()
  
  Dim Video_URLSs As String = ""
  Dim iCount As Integer
  
  IconView_VideoURL.MoveFirst
  For iCount = 1 To IconView_VideoURL.Count
    Video_URLSs = Video_URLSs & " " & IconView_VideoURL.Item.Key
    IconView_VideoURL.MoveNext
  Next
  Print Video_URLSs;
  
End

Public Sub Button_ClearList_Click()
  
  If Message.Question(MSG_ClearList, MSG_ClearList_Yes, MSG_ClearList_No) = 1 Then
    IconView_VideoURL.Clear
  Endif

End

Public Sub Form_Close()

    TrayIcon1.Delete

End
